<form id="form" method="POST">
    <!-- Dados pessoais -->
    <input type="text" name="full_name" id="full_name" placeholder="Nome completo" required>
    <br>
    <input type="email" name="email" id="email" placeholder="E-mail" required>
    <br>
    <input type="password" name="password" id="password" placeholder="Senha" required>
    <br>
    <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirme sua senha" required>
    <br>
    <input type="tel" name="phone" id="phone" placeholder="Telefone para contato" maxlength="15" required>
    <br>
    <input type="text" name="cpf" id="cpf" placeholder="CPF" maxlength="14" required>
    <br>


    <!-- Endereço -->
    <input type="text" name="street" id="street" placeholder="Rua" required>
    <br>
    <input type="text" name="number" id="number" placeholder="Número" required>
    <br>
    <input type="text" name="neighborhood" id="neighborhood" placeholder="Bairro" required>
    <br>
    <select name="state" id="state" required>
        <option value="">Selecione o estado</option>
        {% for state in states %}
            <option value="{{ state['id'] }}">{{ state['nome'] }}</option>
        {% endfor %}
    </select>
    <br>
    <select name="city" id="city" disabled required>
        <option value="">Selecione a cidade</option>
    </select>
    <br>   
    <input type="text" name="complement" id="complement" placeholder="Complemento" required>
    <br>
    <input type="text" name="zip_code" id="zip_code" placeholder="CEP" maxlength="9" required>
    <br>
    

    <button type="submit">Cadastre-se</button>
</form>

<script>
    // JavaScript para atualizar o select de cidades
    document.getElementById('state').addEventListener('change', function() {
        const stateId = this.value;
        fetch(`/user/get_cities?state_id=${stateId}`)
            .then(response => response.json())
            .then(data => {
                const citySelect = document.getElementById('city');
                citySelect.disabled = false;
                citySelect.innerHTML = '';
                data.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city['id'];
                    option.text = city['nome'];
                    citySelect.appendChild(option);
                });
            });
    });

    const phoneInput = document.getElementById('phone');
    
    phoneInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
        value = value.replace(/(\d)(\d{4})$/, '$1-$2');
        e.target.value = value;
    });

    phoneInput.addEventListener('keypress', (e) => {
        const onlyNumbers = /[0-9]/;
        if (!onlyNumbers.test(e.key)) {
            e.preventDefault();
        }
    });

    const cpfInput = document.getElementById('cpf');
    
    cpfInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    });

    cpfInput.addEventListener('keypress', (e) => {
        const onlyNumbers = /[0-9]/;
        if (!onlyNumbers.test(e.key)) {
            e.preventDefault();
        }
    });

    const cepInput = document.getElementById('zip_code');
    
    cepInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/^(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
    });

    cepInput.addEventListener('keypress', (e) => {
        const onlyNumbers = /[0-9]/;
        if (!onlyNumbers.test(e.key)) {
            e.preventDefault();
        }
    });

    const form = document.getElementById('form');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');

    form.addEventListener('submit', (e) => {
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            alert('As senhas não coincidem!');
        }
    });

    confirmPassword.addEventListener('input', () => {
        if (password.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity('As senhas não coincidem!');
        } else {
            confirmPassword.setCustomValidity('');
        }
    });
</script>
